<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Secret Santa</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #111827;
            --muted: #94a3b8;
            --text: #e5e7eb;
            --accent: #22d3ee;
            --error: #ef4444;
            --ok: #10b981;
            --radius: 16px
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
            background: #0f172a;
            color: var(--text);
            min-height: 100vh;
            display: grid;
            place-items: center;
            padding: 24px
        }

        .wrap {
            width: 100%;
            max-width: 720px
        }

        .card {
            background: linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
            border: 1px solid rgba(255,255,255,.10);
            border-radius: var(--radius);
            padding: 22px;
            box-shadow: 0 20px 60px rgba(0,0,0,.35);
            backdrop-filter: blur(8px)
        }

        h1 {
            margin: .2rem 0 .25rem;
            font-size: clamp(22px,3.2vw,30px)
        }

        .sub {
            margin: 0 0 14px;
            color: var(--muted);
            font-size: 14px
        }

        label {
            display: block;
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 6px
        }

        select, input {
            width: 100%;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,.12);
            background: #0b1220;
            color: var(--text);
            font-size: 16px;
            outline: none
        }

        button {
            width: 100%;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,.12);
            background: linear-gradient(180deg,#06b6d4,#0891b2);
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer
        }

            button:active {
                transform: translateY(1px)
            }

        .row {
            display: grid;
            gap: 12px
        }

        .sp {
            height: 8px
        }

        .result {
            margin-top: 14px;
            padding: 14px;
            border-radius: 12px;
            background: #0b1220;
            border: 1px solid rgba(255,255,255,.08)
        }

        .ok {
            color: var(--ok)
        }

        .err {
            color: var(--error)
        }

        .muted {
            color: var(--muted)
        }

        details {
            margin-top: 18px
        }

        summary {
            cursor: pointer;
            color: var(--muted)
        }

        .mono {
            font-family: ui-monospace,Menlo,Consolas,monospace
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="card">
            <h1>üéÅ Family Secret Santa</h1>
            <p class="sub">Pick your name and enter your password (your name + 3 digits).</p>

            <form id="revealForm">
                <div class="row">
                    <div>
                        <label for="name">Your name</label>
                        <select id="name" required></select>
                    </div>
                    <div>
                        <label for="pw">Your password</label>
                        <input id="pw" type="password" placeholder="e.g. Shiven123" required />
                    </div>
                </div>
                <div class="sp"></div>
                <button type="submit">Reveal my person</button>
            </form>

            <div id="out" class="result muted">Enter your details above.</div>

            <!-- Organizer: PIN-locked -->
            <details id="organizer">
                <summary>Organizer ‚ñ∏ Login</summary>

                <div class="result" style="margin-top:10px">
                    <label for="orgPin" style="display:block;margin-bottom:6px;color:#94a3b8;font-size:14px">Enter PIN</label>
                    <div class="row">
                        <input id="orgPin" type="password" inputmode="numeric" pattern="\\d*" placeholder="PIN" />
                        <button id="orgLogin" type="button">Unlock</button>
                    </div>
                    <div id="orgMsg" class="muted" style="margin-top:8px;font-size:14px"></div>
                </div>

                <div id="orgContent" style="display:none">
                    <div class="result mono muted" style="white-space:pre-wrap;margin-top:10px">
                        <b>Passwords (share privately):</b>
                        <div id="pwlist" style="margin-top:6px"></div>
                    </div>
                    <button id="hideOrg" type="button" style="margin-top:8px">Hide this panel (for this device)</button>
                </div>
            </details>

            <p class="muted" style="margin-top:12px;font-size:12px">
                Note: This is a simple static page. Tech-savvy folks could read the page source.
            </p>
        </div>
    </div>

    <script>
        // ====== SIMPLE SETTINGS ======
        const NAMES = ["Aulane", "Jayse", "Melanie", "Milza", "Kevin", "Shiven"];

        // Change this to any secret phrase if you want different passwords/assignments.
        // Keep it the same once shared so things stay consistent.
        const PEPPER = "CHANGE-ME-IF-YOU-WANT";

        // Organizer PIN
        const ORG_PIN = "1304";

        // ====== IMPLEMENTATION ======
        // Seeded RNG from a string (xmur3 + mulberry32)
        function xmur3(str) {
            let h = 1779033703 ^ str.length;
            for (let i = 0; i < str.length; i++) {
                h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
                h = (h << 13) | (h >>> 19);
            }
            return function () {
                h = Math.imul(h ^ (h >>> 16), 2246822507);
                h = Math.imul(h ^ (h >>> 13), 3266489909);
                return (h ^ (h >>> 16)) >>> 0;
            };
        }
        function mulberry32(a) {
            return function () {
                let t = a += 0x6D2B79F5;
                t = Math.imul(t ^ (t >>> 15), t | 1);
                t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
                return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
            }
        }

        // Deterministic random based on PEPPER
        const seed = xmur3("SSANTA::" + PEPPER)();
        const rand = mulberry32(seed);

        // Password helpers
        function normalizeName(s) { return s.replace(/\\s+/g, "").toLowerCase(); }
        function codeFor(name) {
            const s = xmur3("CODE::" + normalizeName(name) + "::" + PEPPER)();
            return (s % 900) + 100; // 100..999
        }
        function expectedPasswordFor(name) { return normalizeName(name) + String(codeFor(name)); }

        // Build a single shuffled cycle assignment (no self, no mutual pairs)
        function singleCycleAssignment(names) {
            const order = names.slice();
            // Fisher‚ÄìYates shuffle with seeded RNG
            for (let i = order.length - 1; i > 0; i--) {
                const j = Math.floor(rand() * (i + 1));
                [order[i], order[j]] = [order[j], order[i]];
            }
            // Map each to the next (last -> first), guarantees:
            // - unique recipients
            // - no self-assignments
            // - no 2-cycles (cycle length is n >= 3)
            const map = new Map();
            for (let i = 0; i < order.length; i++) {
                const giver = order[i];
                const recipient = order[(i + 1) % order.length];
                map.set(giver, recipient);
            }
            return map;
        }

        // Prepare UI dropdown
        const sel = document.getElementById("name");
        NAMES.forEach(n => {
            const o = document.createElement("option"); o.value = n; o.textContent = n; sel.appendChild(o);
        });

        // Compute assignments once (stable for this PEPPER)
        const assignMap = singleCycleAssignment(NAMES);

        // Reveal handler
        const out = document.getElementById("out");
        document.getElementById("revealForm").addEventListener("submit", (e) => {
            e.preventDefault();
            const name = sel.value;
            const pw = (document.getElementById("pw").value || "").trim();

            if (!pw) { out.className = "result err"; out.textContent = "Please enter a password."; return; }

            const expected = expectedPasswordFor(name);
            if (normalizeName(pw) !== expected) {
                out.className = "result err";
                out.textContent = "Incorrect password.";
                return;
            }

            const recipient = assignMap.get(name);
            out.className = "result ok";
            out.innerHTML = `üéÑ <b>${name}</b>, you are buying for <b>${recipient}</b>!`;
            document.getElementById("pw").value = "";
        });

        // ----- Organizer (PIN lock) -----
        const organizer = document.getElementById("organizer");
        const orgPinInput = document.getElementById("orgPin");
        const orgLoginBtn = document.getElementById("orgLogin");
        const orgMsg = document.getElementById("orgMsg");
        const orgContent = document.getElementById("orgContent");
        const pwlist = document.getElementById("pwlist");

        const HIDE_KEY = "hide_organizer_panel";
        if (localStorage.getItem(HIDE_KEY) === "1") organizer.removeAttribute("open");

        orgLoginBtn.addEventListener("click", () => {
            const pin = (orgPinInput.value || "").trim();
            if (pin !== ORG_PIN) {
                orgMsg.textContent = "Incorrect PIN.";
                orgMsg.className = "err";
                return;
            }
            orgMsg.textContent = "Unlocked.";
            orgMsg.className = "ok";
            orgContent.style.display = "block";

            // Generate passwords now (after unlock)
            pwlist.textContent = NAMES.map(n => `${n}: ${normalizeName(n)}${codeFor(n)}`).join("\\n");
        });

        document.getElementById("hideOrg").addEventListener("click", () => {
            organizer.removeAttribute("open");
            localStorage.setItem(HIDE_KEY, "1");
        });
    </script>
</body>
</html>
