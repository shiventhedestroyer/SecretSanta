<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Secret Santa</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #111827;
            --muted: #94a3b8;
            --text: #e5e7eb;
            --accent: #22d3ee;
            --error: #ef4444;
            --ok: #10b981;
            --radius: 16px
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
            background: #0f172a;
            color: var(--text);
            min-height: 100vh;
            display: grid;
            place-items: center;
            padding: 24px
        }

        .wrap {
            width: 100%;
            max-width: 720px
        }

        .card {
            background: linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
            border: 1px solid rgba(255,255,255,.10);
            border-radius: var(--radius);
            padding: 22px;
            box-shadow: 0 20px 60px rgba(0,0,0,.35);
            backdrop-filter: blur(8px)
        }

        h1 {
            margin: .2rem 0 .25rem;
            font-size: clamp(22px,3.2vw,30px)
        }

        .sub {
            margin: 0 0 14px;
            color: var(--muted);
            font-size: 14px
        }

        label {
            display: block;
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 6px
        }

        select, input {
            width: 100%;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,.12);
            background: #0b1220;
            color: var(--text);
            font-size: 16px;
            outline: none
        }

        button {
            width: 100%;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,.12);
            background: linear-gradient(180deg,#06b6d4,#0891b2);
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer
        }

            button:active {
                transform: translateY(1px)
            }

        .row {
            display: grid;
            gap: 12px
        }

        .sp {
            height: 8px
        }

        .result {
            margin-top: 14px;
            padding: 14px;
            border-radius: 12px;
            background: #0b1220;
            border: 1px solid rgba(255,255,255,.08)
        }

        .ok {
            color: var(--ok)
        }

        .err {
            color: var(--error)
        }

        .muted {
            color: var(--muted)
        }

        details {
            margin-top: 18px
        }

        summary {
            cursor: pointer;
            color: var(--muted)
        }

        .mono {
            font-family: ui-monospace,Menlo,Consolas,monospace
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="card">
            <h1>üéÅ Family Secret Santa</h1>
            <p class="sub">Pick your name and enter your password (your name + 3 digits).</p>

            <form id="revealForm">
                <div class="row">
                    <div>
                        <label for="name">Your name</label>
                        <select id="name" required></select>
                    </div>
                    <div>
                        <label for="pw">Your password</label>
                        <input id="pw" type="password" placeholder="e.g. Shiven123" required />
                    </div>
                </div>
                <div class="sp"></div>
                <button type="submit">Reveal my person</button>
            </form>

            <div id="out" class="result muted">Enter your details above.</div>

            <!-- Organizer panel: shows generated passwords so you can share them.
                 Delete this entire <details> block before sharing the link if you want. -->
            <details id="organizer">
                <summary>Organizer ‚ñ∏ Show generated passwords</summary>
                <div id="pwlist" class="result mono muted" style="white-space:pre-wrap"></div>
                <button id="hideOrg" type="button" style="margin-top:8px">Hide this panel (for this device)</button>
            </details>

            <p class="muted" style="margin-top:12px;font-size:12px">
                Note: This is a simple static page. Tech-savvy folks could read the page source.
            </p>
        </div>
    </div>

    <script>
        // ====== SIMPLE SETTINGS ======
        const NAMES = ["Aulane", "Jayse", "Melanie", "Milza", "Kevin", "Shiven"];

        // Change this to any secret phrase if you want different passwords/assignments.
        // Keep it the same once shared so things stay consistent.
        const PEPPER = "CHANGE-ME-IF-YOU-WANT";

        // ====== IMPLEMENTATION (no need to edit below) ======
        // Seeded RNG from a string (xmur3 + mulberry32)
        function xmur3(str) { let h = 1779033703 ^ str.length; for (let i = 0; i < str.length; i++) { h = Math.imul(h ^ str.charCodeAt(i), 3432918353); h = h << 13 | h >>> 19; } return function () { h = Math.imul(h ^ (h >>> 16), 2246822507); h = Math.imul(h ^ (h >>> 13), 3266489909); return (h ^ (h >>> 16)) >>> 0; } }
        function mulberry32(a) { return function () { let t = a += 0x6D2B79F5; t = Math.imul(t ^ (t >>> 15), t | 1); t ^= t + Math.imul(t ^ (t >>> 7), t | 61); return ((t ^ (t >>> 14)) >>> 0) / 4294967296; } }

        const seed = xmur3(PEPPER)();
        const rand = mulberry32(seed);

        // Make a stable "random" 3-digit code per name: 100..999
        function codeFor(name) {
            const s = xmur3(name + "::" + PEPPER)();
            return (s % 900) + 100;
        }

        // Password format: "<name><3digits>" (case/spacing of the name ignored)
        function normalizeName(s) { return s.replace(/\s+/g, "").toLowerCase(); }
        function expectedPasswordFor(name) { return normalizeName(name) + String(codeFor(name)); }

        // Build a derangement (no one gets themselves), stable from PEPPER
        function derangement(list) {
            // Start with a copy, then seeded Fisher‚ÄìYates shuffle until valid
            const out = list.slice();
            // Seeded shuffle
            for (let i = out.length - 1; i > 0; i--) {
                const j = Math.floor(rand() * (i + 1));
                [out[i], out[j]] = [out[j], out[i]];
            }
            // If anyone maps to themselves, fix with simple swaps
            for (let i = 0; i < list.length; i++) {
                if (out[i] === list[i]) {
                    // swap with next (or previous if last)
                    const j = (i === list.length - 1) ? i - 1 : i + 1;
                    [out[i], out[j]] = [out[j], out[i]];
                }
            }
            // Double-check (safety)
            for (let i = 0; i < list.length; i++) {
                if (out[i] === list[i]) {
                    // last resort rotate by 1
                    out.unshift(out.pop());
                    break;
                }
            }
            return out;
        }

        // Prepare dropdown
        const sel = document.getElementById("name");
        NAMES.forEach(n => {
            const o = document.createElement("option"); o.value = n; o.textContent = n; sel.appendChild(o);
        });

        // Make stable assignments
        const assigned = derangement(NAMES);

        // Handle reveal
        const out = document.getElementById("out");
        document.getElementById("revealForm").addEventListener("submit", (e) => {
            e.preventDefault();
            const name = sel.value;
            const pw = (document.getElementById("pw").value || "").trim();
            if (!pw) { out.className = "result err"; out.textContent = "Please enter a password."; return; }

            if (normalizeName(pw).startsWith(normalizeName(name))) {
                // Allow users who type "Name123" with any case/spaces
            }
            const expected = expectedPasswordFor(name);
            if (normalizeName(pw) !== expected) {
                out.className = "result err";
                out.textContent = "Incorrect password.";
                return;
            }
            // Find recipient index
            const i = NAMES.indexOf(name);
            const recipient = assigned[i];
            out.className = "result ok";
            out.innerHTML = `üéÑ <b>${name}</b>, you are buying for <b>${recipient}</b>!`;
            // Optional: clear the password box
            document.getElementById("pw").value = "";
        });

        // Organizer: show generated passwords so you can share privately
        const pwlist = document.getElementById("pwlist");
        pwlist.textContent = NAMES.map(n => `${n}: ${normalizeName(n)}${codeFor(n)}`).join("\n");

        // Allow hiding organizer panel on this device
        const organizer = document.getElementById("organizer");
        const HIDE_KEY = "hide_organizer_panel";
        if (localStorage.getItem(HIDE_KEY) === "1") organizer.removeAttribute("open");
        document.getElementById("hideOrg").addEventListener("click", () => {
            organizer.removeAttribute("open");
            localStorage.setItem(HIDE_KEY, "1");
        });
    </script>
</body>
</html>
